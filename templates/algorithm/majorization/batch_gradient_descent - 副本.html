{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>批量梯度下降</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="{% static 'plugins/font-awesome/css/../../../static/css/font-awesome.min.css' %}">
    <link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link rel="stylesheet" href="{% static 'dist/css/adminlte.min.css' %}">
    <link rel="stylesheet" href="{% static 'plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.min.css' %}">
    <link href="{% static 'images/../../../static/img/my.ico' %}" rel="shortcut icon">
    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700" rel="stylesheet">
    <script src="{% static 'plugins/jquery/jquery.min.js' %}"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
    <script src="{% static 'plugins/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/raphael/2.1.0/raphael-min.js"></script>
    <script src="{% static 'dist/js/adminlte.js' %}"></script>
    <script src="{% static 'dist/js/pages/dashboard.js' %}"></script>
    <script src="http://static.runoob.com/assets/jquery-validation-1.14.0/lib/jquery.js"></script>
    <script src="http://static.runoob.com/assets/jquery-validation-1.14.0/dist/jquery.validate.min.js"></script>
    <script src="http://static.runoob.com/assets/jquery-validation-1.14.0/dist/localization/messages_zh.js"></script>
    <script src="{% static 'echarts.min.js' %}"></script>
    <style>
        label {
            width: 200px;
            margin-left: 20px;
        }

        .high {
            color: red;
        }

        .msg {
            font-size: 13px;
            margin-top: -100px;
        }

        .onError {
            color: red;
        }

        .onSuccess {
            color: green;
        }
    </style>
</head>
<body class="hold-transition sidebar-mini">
<div class="wrapper">
    <nav class="main-header navbar navbar-expand bg-white navbar-light border-bottom">
        <ul class="navbar-nav">
            <li class="nav-item">
                <a class="nav-link" data-widget="pushmenu" href="#"><i class="fa fa-bars"></i></a>
            </li>
        </ul>
    </nav>
    <aside class="main-sidebar sidebar-dark-primary elevation-4">
        <a href="{% url 'ALGDemo:batch_gradient_descent' %}" class="brand-link">
            <img src="{% static 'dist/../../../static/img/AdminLTELogo.png' %}" alt="AdminLTE Logo"
                 class="brand-image img-circle elevation-3"
                 style="opacity: .8">
            <span class="brand-text font-weight-light">Machine Learning</span>
        </a>
        <div class="sidebar">
            <div class="user-panel mt-3 pb-3 mb-3 d-flex">
                <div class="image">
                    <img src="{% static 'dist/../../../static/img/user2-160x160.jpg' %}" class="img-circle elevation-2"
                         alt="User Image">
                </div>
                <div class="info">
                    <a href="#" class="d-block">Administrator</a>
                </div>
            </div>
            <nav class="mt-2">
                <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu"
                    data-accordion="true">
                    <li class="nav-item">
                        <a href="{% url 'ALGDemo:document' %}" class="nav-link">
                            <i class="nav-icon fa fa-th"></i>
                            <p>
                                文档
                            </p>
                        </a>
                    </li>
                    <li class="nav-header">算法</li>
                    <li class="nav-item has-treeview">
                        <a href="#" class="nav-link">
                            <i class="nav-icon fa fa-dashboard"></i>
                            <p>
                                仿真数据生成
                                <i class="right fa fa-angle-left"></i>
                            </p>
                        </a>
                        <ul class="nav nav-treeview">
                            <li class="nav-item">
                                <a href="#" class="nav-link">
                                    <p>回归模型仿真数据</p>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="#" class="nav-link">
                                    <p>分类模型仿真数据</p>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="#" class="nav-link">
                                    <p>聚类模型仿真数据</p>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="#" class="nav-link">
                                    <p>分组正态分布混合仿真数据</p>
                                </a>
                            </li>
                        </ul>
                    </li>
                    <li class="nav-item has-treeview menu-open">
                        <a href="#" class="nav-link active">
                            <i class="nav-icon fa fa-dashboard"></i>
                            <p>
                                优化算法
                                <i class="right fa fa-angle-left"></i>
                            </p>
                        </a>
                        <ul class="nav nav-treeview">
                            <li class="nav-item">
                                <a href="{% url 'ALGDemo:least_square_method' %}" class="nav-link">
                                    <p>最小二乘法</p>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="{% url 'ALGDemo:batch_gradient_descent' %}" class="nav-link active">
                                    <p>批量梯度下降</p>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="{% url 'ALGDemo:stochastic_gradient_descent' %}" class="nav-link">
                                    <p>随机梯度下降</p>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="{% url 'ALGDemo:stochastic_gradient_descent' %}" class="nav-link">
                                    <p>牛顿法</p>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="{% url 'ALGDemo:stochastic_gradient_descent' %}" class="nav-link">
                                    <p>拟牛顿法</p>
                                </a>
                            </li>
                        </ul>
                    </li>

                    <li class="nav-item has-treeview">
                        <a href="#" class="nav-link">
                            <i class="nav-icon fa fa-pie-chart"></i>
                            <p>
                                K-近邻
                                <i class="right fa fa-angle-left"></i>
                            </p>
                        </a>
                        <ul class="nav nav-treeview">
                            <li class="nav-item">
                                <a href="#" class="nav-link">
                                    <p>算法一</p>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="#" class="nav-link">
                                    <p>算法二</p>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="#" class="nav-link">
                                    <p>算法三</p>
                                </a>
                            </li>
                        </ul>
                    </li>
                    <li class="nav-item has-treeview">
                        <a href="#" class="nav-link">
                            <i class="nav-icon fa fa-pie-chart"></i>
                            <p>
                                朴素贝叶斯
                                <i class="right fa fa-angle-left"></i>
                            </p>
                        </a>
                        <ul class="nav nav-treeview">
                            <li class="nav-item">
                                <a href="#" class="nav-link">
                                    <p>算法一</p>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="#" class="nav-link">
                                    <p>算法二</p>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="#" class="nav-link">
                                    <p>算法三</p>
                                </a>
                            </li>
                        </ul>
                    </li>
                    <li class="nav-item has-treeview">
                        <a href="#" class="nav-link">
                            <i class="nav-icon fa fa-pie-chart"></i>
                            <p>
                                Logistic回归
                                <i class="right fa fa-angle-left"></i>
                            </p>
                        </a>
                        <ul class="nav nav-treeview">
                            <li class="nav-item">
                                <a href="#" class="nav-link">
                                    <p>算法一</p>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="#" class="nav-link">
                                    <p>算法二</p>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="#" class="nav-link">
                                    <p>算法三</p>
                                </a>
                            </li>
                        </ul>
                    </li>
                    <li class="nav-item has-treeview">
                        <a href="#" class="nav-link">
                            <i class="nav-icon fa fa-tree"></i>
                            <p>
                                支持向量机
                                <i class="fa fa-angle-left right"></i>
                            </p>
                        </a>
                        <ul class="nav nav-treeview">
                            <li class="nav-item">
                                <a href="#" class="nav-link">
                                    <i class="fa fa-circle-o nav-icon"></i>
                                    <p>算法一</p>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="#" class="nav-link">
                                    <i class="fa fa-circle-o nav-icon"></i>
                                    <p>算法二</p>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="#" class="nav-link">
                                    <i class="fa fa-circle-o nav-icon"></i>
                                    <p>算法三</p>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="#" class="nav-link">
                                    <i class="fa fa-circle-o nav-icon"></i>
                                    <p>算法四</p>
                                </a>
                            </li>
                        </ul>
                    </li>
                    <li class="nav-item has-treeview">
                        <a href="#" class="nav-link">
                            <i class="nav-icon fa fa-edit"></i>
                            <p>
                                决策树
                                <i class="fa fa-angle-left right"></i>
                            </p>
                        </a>
                        <ul class="nav nav-treeview">
                            <li class="nav-item">
                                <a href="#" class="nav-link">
                                    <p>算法一</p>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="#" class="nav-link">
                                    <p>算法二</p>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="#" class="nav-link">
                                    <p>算法三</p>
                                </a>
                            </li>
                        </ul>
                    </li>
                    <li class="nav-item has-treeview">
                        <a href="#" class="nav-link">
                            <i class="nav-icon fa fa-table"></i>
                            <p>
                                神经网络
                                <i class="fa fa-angle-left right"></i>
                            </p>
                        </a>
                        <ul class="nav nav-treeview">
                            <li class="nav-item">
                                <a href="#" class="nav-link">
                                    <i class="fa fa-circle-o nav-icon"></i>
                                    <p>
                                        算法一
                                    </p>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="#" class="nav-link">
                                    <i class="fa fa-circle-o nav-icon"></i>
                                    <p>
                                        算法二
                                    </p>
                                </a>
                            </li>
                        </ul>
                    </li>
                    <li class="nav-header">应用</li>
                    <li class="nav-item">
                        <a href="#" class="nav-link">
                            <i class="nav-icon fa fa-calendar"></i>
                            <p>
                                车牌识别
                            </p>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link">
                            <i class="nav-icon fa fa-calendar"></i>
                            <p>
                                交通标志识别
                            </p>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link">
                            <i class="nav-icon fa fa-calendar"></i>
                            <p>
                                手写体识别
                            </p>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link">
                            <i class="nav-icon fa fa-calendar"></i>
                            <p>
                                人脸识别
                            </p>
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
    </aside>
    <div class="content-wrapper">
        <section class="content">
            <div class="container-fluid">
                <div class="row">
                    <div id="collapseOne" class="panel-collapse collapse in">
                        <div class="card card-danger">
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-12">
                                        <div class="row1">
                                            <form id="signupForm">
                                                <div class="row row2">
                                                    <div class="col-2">
                                                        <label for="k">斜率</label>
                                                        <input type="text" id="k" name="k" class="form-control">
                                                    </div>
                                                    <div class="col-2">
                                                        <label for="b">截距</label>
                                                        <input type="text" id="b" name="b" class="form-control"/>
                                                    </div>
                                                    <div class="col-2">
                                                        <label for="N_true">标准数据个数</label>
                                                        <input type="text" class="form-control" name="N_true"
                                                               id="N_true">
                                                    </div>
                                                    <div class="col-2">
                                                        <label for="N_noise">噪声数据个数</label>
                                                        <input type="text" class="form-control" name="N_noise"
                                                               id="N_noise">
                                                    </div>
                                                    <div class="col-2">
                                                        <label for="mu">均值</label>
                                                        <input type="text" class="form-control" name="mu" id="mu">
                                                    </div>
                                                    <div class="col-2">
                                                        <label for="sigma">标准差</label>
                                                        <input type="text" class="form-control" name="sigma" id="sigma">
                                                    </div>
                                                    <div class="col-2">
                                                        <button type="button" class="btn btn-block btn-success btn-lg"
                                                                id="tijiao" style="margin-top:30px;">提交
                                                        </button>
                                                    </div>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="container-fluid">
                        <div class="row">
                            <div class="col-sm-6">
                            </div>
                            <div class="col-sm-6" style="font-family: 幼圆">
                                <ol class="breadcrumb float-sm-right">
                                    {% if user.is_authenticated %}  <!--用户已登录-->
                                        <li class="breadcrumb-item">
                                            {{ user_name }}
                                            <a href="{% url 'ALGDemo:logout' %}">
                                                注销
                                            </a>
                                        </li>
                                    {% else %}  <!--用户未登录-->
                                        <li class="breadcrumb-item">
                                            <a href="{% url 'ALGDemo:login' %}">
                                                登录
                                            </a>
                                        </li>
                                        <li class="breadcrumb-item active">
                                            <a href="{% url 'ALGDemo:register' %}">
                                                注册
                                            </a>
                                        </li>
                                    {% endif %}
                                    <li style="padding-left:5rem">
                                        <nav class="main-header navbar navbar-expand bg-white navbar-light1 border-bottom">
                                            <ul class="navbar-nav">
                                                <li class="nav-item">
                                                    <a class="nav-link" data-widget="pushmen" href="#collapseOne"
                                                       data-toggle="collapse" data-parent="#accordion"
                                                       style="padding:0px;">
                                                        <img src="{% static 'dist/../../../static/img/push.jpg' %}"
                                                             style="width:20px;height:20px;"/>
                                                    </a>
                                                </li>
                                            </ul>
                                            <style>
                                                .navbar-light1 {
                                                    right: 7%;
                                                    position: absolute;
                                                    margin-left: 0;
                                                    height: 30px;
                                                }

                                                .navbar-light {
                                                    position: absolute;
                                                }

                                                .card-body {
                                                    flex: 1 1 auto;
                                                    padding: 1.25rem 5vw;
                                                }

                                                label {
                                                    font-size: 0.5vh;
                                                }

                                                .card-danger {
                                                    width: 100%;
                                                    margin-left: 0.5%;
                                                }

                                                label:not(.form-check-label):not(.custom-file-label) {
                                                {#// font-weight: 1;#} font-family: 楷体;
                                                }

                                                #collapseOne {
                                                    width: 100%;
                                                    margin-right: 1%;
                                                }

                                                @media only screen and (max-width: 500px) {

                                                    .btn-lg {
                                                        font-size: 16px;
                                                    }

                                                    .btn-lg {
                                                        padding: .25rem 1rem;
                                                        font-size: 1vmax;
                                                    }
                                                }

                                                .sidebar-dark-primary {
                                                    font-family: 幼圆
                                                }
                                            </style>
                                        </nav>
                                    </li>
                                </ol>
                            </div>
                        </div>
                    </div>
                    <style>
                        .row1 {
                            position: relative;
                            padding: 0 50px;
                        }

                        .col-2 {
                            flex: 0 0 16.666667%;
                            max-width: 10.666667%;
                        }

                        .row2 {
                            padding-left: 4vw;
                        }

                        .error {
                            color: red;
                        }
                    </style>
                    <section class="col-lg-12 connectedSortable">
                        <div id="main" style="width: 100%;height:600px;margin-top:3%;"></div>
                    </section>
                </div>
            </div>
        </section>
    </div>
</div>
<script>
    $(document).ready(function () {
        $(function () {
            var data = {{ data|safe }};
            drawBar("main", data);
        });
// 在键盘按下并释放及提交后验证提交表单
        $(function () {
            $("#signupForm").validate({
                onkeyup: true,
                rules: {
                    k: {
                        range: [1, 1000],
                        required: true
                    },
                    b: {
                        range: [1, 1000],
                        required: true
                    },
                    N_true: {
                        range: [10, 200],
                        required: true
                    },
                    N_noise: {
                        range: [10, 200],
                        required: true
                    },
                    mu: {
                        range: [1, 50],
                        required: true
                    },
                    sigma: {
                        range: [1, 50],
                        required: true
                    },
                },
                messages: {}
            });
        });

        data = {};
        $.ajaxSetup({  // ajaxSetup() 方法为将来的 AJAX 请求设置默认值
            data: {csrfmiddlewaretoken: '{{ csrf_token }}'},  // data键表示规定要发送到服务器的数据
        });
        $('#tijiao').click(function () {  // 当提交表单时，会发生submit事件。该事件只适用于表单元素
            // submit()方法触发submit事件，或规定当发生submit事件时运行的函数
            if (!$("#signupForm").valid()) {
                // alert("数据不合理!");
                return;
            }
            data.k = $("#k").val();  // 对id为k的元素执行val()方法，以获取input输入的值
            data.b = $("#b").val();  // 同上
            data.N_true = $("#N_true").val();  // 同上
            data.N_noise = $("#N_noise").val();  // 同上
            data.mu = $("#mu").val();  // 同上
            data.sigma = $("#sigma").val();  // 同上
            $.ajax({  //ajax()方法用于执行 AJAX（异步 HTTP）请求，所有的jQuery AJAX方法都使用ajax()方法
                type: "POST",  // 规定请求的类型（GET 或 POST）
                data: data,  // 规定要发送到服务器的数据
                url: "{% url 'ALGDemo:batch_gradient_descent' %}", //后台处理函数的url 这里用的是static url 需要与urls.py中的name一致
                cache: false,  // 布尔值，表示浏览器是否缓存被请求页面。默认是 true
                dataType: "json",  // 预期的服务器响应的数据类型
                error: erryFunction,  //错误执行方法
                success: succFunction //成功执行方法
            });

            function succFunction(data) {  // 当请求成功时运行的函数
                drawBar("main", data);
            }

            function erryFunction() {
                alert('数据请求错误！')
            }

            return false;
        });

        function drawBar(divId, data) {
            var myChart = echarts.init(document.getElementById(divId));
            var option = {
                title: {
                    text: '线性回归仿真数据',
                },
                grid: {
                    left: '10%',
                    right: '7%',
                    bottom: '3%',
                    containLabel: false
                },
                tooltip: {
                    // trigger: 'axis',
                    showDelay: 0,
                    formatter: function (params) {
                        if (params.value.length > 1) {
                            return params.seriesName + ' :<br/>'
                                + params.value[0] + '，'
                                + params.value[1];
                        }
                        else {
                            return params.seriesName + ' :<br/>'
                                + params.name + ' : '
                                + params.value;
                        }
                    },
                    axisPointer: {
                        show: true,
                        type: 'cross',
                        lineStyle: {
                            type: 'dashed',
                            width: 100
                        }
                    }
                },
                toolbox: {
                    feature: {
                        dataZoom: {},
                        brush: {
                            type: ['rect', 'polygon', 'clear']
                        },
                        dataView: {
                            show: true,
                            readOnly: false
                        },
                        saveAsImage: {
                            show: true
                        }
                    }
                },
                brush: {},
                legend: {
                    data: ['噪声数据', '标准数据', '仿真数据', '标准直线', '回归直线'],
                    left: 'center'
                },
                xAxis: [
                    {
                        type: 'value',
                        scale: true,
                        axisLabel: {
                            formatter: '{value} '
                        },
                        splitLine: {
                            show: false
                        }
                    }
                ],
                yAxis: [
                    {
                        type: 'value',
                        scale: true,
                        axisLabel: {
                            formatter: '{value} '
                        },
                        splitLine: {
                            show: false
                        }
                    }
                ],
                series: [
                    {
                        name: '噪声数据',
                        type: 'scatter',
                        data: data.Noisy_Points,
                        markArea: {
                            silent: true,
                            itemStyle: {
                                normal: {
                                    color: 'transparent',
                                    borderWidth: 1,
                                    borderType: 'dashed'
                                }
                            },
                            data: [[{
                                name: '噪声数据分布区间',
                                xAxis: 'min',
                                yAxis: 'min'
                            }, {
                                xAxis: 'max',
                                yAxis: 'max'
                            }]]
                        },
                        markPoint: {
                            data: [
                                {type: 'max', name: '最大值'},
                                {type: 'min', name: '最小值'}
                            ]
                        },
                        markLine: {
                            lineStyle: {
                                normal: {
                                    type: 'solid'
                                }
                            },
                            data: [
                                {type: 'average', name: '平均值'},
                                {xAxis: 160}
                            ]
                        }
                    },
                    {
                        name: '标准数据',
                        type: 'scatter',
                        data: data.True_Points,
                        markArea: {
                            silent: true,
                            itemStyle: {
                                normal: {
                                    color: 'transparent',
                                    borderWidth: 1,
                                    borderType: 'dashed'
                                }
                            },
                            data: [[{
                                name: '标准数据分布区间',
                                xAxis: 'min',
                                yAxis: 'min'
                            }, {
                                xAxis: 'max',
                                yAxis: 'max'
                            }]]
                        },
                        markPoint: {
                            data: [
                                {type: 'max', name: '最大值'},
                                {type: 'min', name: '最小值'}
                            ]
                        },
                        markLine: {
                            lineStyle: {
                                normal: {
                                    type: 'solid'
                                }
                            },
                            data: [
                                {type: 'average', name: '平均值'},
                                {xAxis: 170}
                            ]
                        }
                    },
                    {
                        name: '仿真数据',
                        type: 'scatter',
                        data: data.Simulation_data,
                        markArea: {
                            silent: true,
                            itemStyle: {
                                normal: {
                                    color: 'transparent',
                                    borderWidth: 1,
                                    borderType: 'dashed'
                                }
                            },
                            data: [[{
                                name: '仿真数据分布区间',
                                xAxis: 'min',
                                yAxis: 'min'
                            }, {
                                xAxis: 'max',
                                yAxis: 'max'
                            }]]
                        },
                        markPoint: {
                            data: [
                                {type: 'max', name: '最大值'},
                                {type: 'min', name: '最小值'}
                            ]
                        },
                        markLine: {
                            lineStyle: {
                                normal: {
                                    type: 'solid'
                                }
                            },
                            data: [
                                {type: 'average', name: '平均值'},
                                {xAxis: 170}
                            ]
                        }
                    },
                    {
                        name: '标准直线',
                        type: 'line',
                        showSymbol: false,
                        data: data.True_Points,
                        lineStyle: {
                            color: 'red',
                            width: 3
                        },
                        markPoint: {
                            itemStyle: {
                                normal: {
                                    color: 'transparent'
                                }
                            },
                            label: {
                                normal: {
                                    show: true,
                                    position: 'left',
                                    // formatter: myRegression.expression,
                                    textStyle: {
                                        color: '#333',
                                        fontSize: 14
                                    }
                                }
                            },
                            // data: [{
                            // coord: myRegression.points[myRegression.points.length - 1]
                            // }]
                        }
                    },
                    {
                        name: '回归直线',
                        type: 'line',
                        showSymbol: false,
                        data: data.Fitted_data,
                        lineStyle: {
                            color: 'blue',
                            width: 3
                        },
                        markPoint: {
                            itemStyle: {
                                normal: {
                                    color: 'transparent'
                                }
                            },
                            label: {
                                normal: {
                                    show: true,
                                    position: 'left',
                                    // formatter: myRegression.expression,
                                    textStyle: {
                                        color: '#333',
                                        fontSize: 14
                                    }
                                }
                            },
                            // data: [{
                            // coord: myRegression.points[myRegression.points.length - 1]
                            // }]
                        }
                    }
                ]
            };
            myChart.setOption(option);
        }
    });
</script>
</body>
</html>
